<% assigned_contact = @issue.contacts.try(:first)
   if !assigned_contact
     if (cf = IssueCustomField.find_by(name: 'Assigned Contact'))
       val = @issue.try(:custom_field_value, cf)
       assigned_contact = Contact.find_by(id: val.to_i) if val.present?
     end
   end %>
<% if assigned_contact %>
<script>
  (function() {
    var attrs = document.querySelector('.issue .attributes');
    if (!attrs) return;
    var dts = attrs.querySelectorAll('dt');
    var targetDt = null;
    for (var i = 0; i < dts.length; i++) {
      var txt = (dts[i].textContent || '').trim();
      if (txt === '<%= j l(:field_assigned_to) %>') { targetDt = dts[i]; break; }
    }
    if (!targetDt) return;
    var dd = targetDt.nextElementSibling;
    if (!dd) return;
    dd.innerHTML = '<%= j(contact_tag(assigned_contact, type: "plain")) %>';
  })();
</script>
<% end %>
